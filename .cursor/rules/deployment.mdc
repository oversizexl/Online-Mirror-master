---
description: Cloudflare éƒ¨ç½²æµç¨‹å’Œå‘½ä»¤
---

# Cloudflare éƒ¨ç½²è§„åˆ™

## ğŸš€ éƒ¨ç½²å‘½ä»¤

### éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ (Main åˆ†æ”¯ - è‡ªå®šä¹‰åŸŸå)

```bash
# ä½¿ç”¨ pnpm (æ¨è)
pnpm exec wrangler pages deploy . --project-name=online-mirror --branch=main --commit-dirty=true

# æˆ–ä½¿ç”¨ npx (ä¹Ÿå¯ä»¥)
npx wrangler pages deploy . --project-name=online-mirror --branch=main --commit-dirty=true
```

æˆ–ä½¿ç”¨å¿«æ·è„šæœ¬ï¼š

- Windows: `scripts/deploy-main.bat`
- Linux/Mac: `scripts/deploy-main.sh`

### éƒ¨ç½² Worker API

```bash
# ä½¿ç”¨ pnpm (æ¨è)
pnpm exec wrangler deploy

# æˆ–ç›´æ¥ä½¿ç”¨ wrangler (å¦‚å·²å…¨å±€å®‰è£…)
wrangler deploy
```

## ğŸ“¦ åŒ…ç®¡ç†

æœ¬é¡¹ç›®ä½¿ç”¨ **pnpm** ä½œä¸ºåŒ…ç®¡ç†å™¨ï¼š

```bash
# å®‰è£…ä¾èµ–
pnpm install

# è¿è¡Œè„šæœ¬
pnpm run test         # å¯åŠ¨æœ¬åœ°å‰ç«¯æœåŠ¡å™¨
pnpm run test-full    # å¯åŠ¨å‰ç«¯+Worker
pnpm run dev-worker   # å¯åŠ¨Workerå¼€å‘æœåŠ¡å™¨
pnpm run deploy-worker # éƒ¨ç½²Worker
```

## ğŸ“‹ éƒ¨ç½²å‰æ£€æŸ¥æ¸…å•

1. âœ… æ£€æŸ¥ [config.js](mdc:config.js) ä¸­çš„ API_BASE_URL æ˜¯å¦æ­£ç¡®
2. âœ… ç¡®è®¤ R2 å­˜å‚¨æ¡¶ `photos` å·²åˆ›å»ºï¼ˆç»‘å®šåç§°ï¼š`PHOTO_BUCKET`ï¼‰
3. âœ… æµ‹è¯•æ‰€æœ‰é¡µé¢åŠŸèƒ½æ­£å¸¸
4. âœ… æ£€æŸ¥æ˜¯å¦æœ‰ console.log è°ƒè¯•ä»£ç ï¼ˆå…è®¸ console.errorï¼‰
5. âœ… ç¡®è®¤éƒ¨ç½²åˆ° main åˆ†æ”¯ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
6. âœ… Worker çš„ wrangler.toml ä¸­ R2 ç»‘å®šæœªæ”¹åŠ¨

## ğŸ” ä»£ç å®¡æŸ¥æ¸…å•ï¼ˆå¼€å‘å®Œæˆå‰é€é¡¹ç¡®è®¤ï¼‰

- âœ… API å‡ç» `window.API_CONFIG`ï¼Œæ— ç¡¬ç¼–ç  URL/çŸ­é“¾æ¥
- âœ… URL/Base64 é€»è¾‘ç¬¦åˆ `url-encoding.mdc`ï¼Œå¹¶å…¼å®¹æ—§æ ¼å¼
- âœ… æ‹ç…§ä¸ä¸Šä¼ éµå¾ª 10ms + `keepalive`ï¼Œæ‘„åƒå¤´æµæ­£ç¡®å…³é—­
- âœ… é¡µé¢ä»…ä½¿ç”¨è‡ªå®šä¹‰ Toast/Confirmï¼Œæ ·å¼ä¸å¸ƒå±€æ»¡è¶³ç§»åŠ¨ç«¯
- âœ… æ‰€æœ‰ç”¨æˆ·è¾“å…¥å…ˆæ ¡éªŒå†ä½¿ç”¨ï¼ŒDOM å†™å…¥é¿å… `innerHTML`
- âœ… Worker å“åº”å« CORS å¤´ï¼Œé”™è¯¯è¿”å›ç»“æ„ä¸ç°æœ‰æ ¼å¼ä¸€è‡´
- âœ… æ§åˆ¶å°æ— è­¦å‘Šå’Œé”™è¯¯

## ğŸ”‘ é‡è¦æ¦‚å¿µ

### åˆ†æ”¯è¯´æ˜

- **main**: ç”Ÿäº§åˆ†æ”¯ï¼Œç»‘å®šè‡ªå®šä¹‰åŸŸå `https://zk9999902.dpdns.org`

### ç¯å¢ƒå˜é‡

- Worker é€šè¿‡ [wrangler.toml](mdc:wrangler.toml) é…ç½® R2 ç»‘å®š
- Pages é€šè¿‡ [config.js](mdc:config.js) è·å– Worker API åœ°å€

### åŒ…ç®¡ç†å™¨

- **ä½¿ç”¨**: pnpmï¼ˆé¡¹ç›®åŒ…å« `pnpm-lock.yaml`ï¼‰
- **åŸå› **: æ›´å¿«çš„å®‰è£…é€Ÿåº¦ã€æ›´å°‘çš„ç£ç›˜ç©ºé—´å ç”¨
- **å‘½ä»¤**: ä½¿ç”¨ `pnpm` æ›¿ä»£ `npm`

## âš ï¸ å¸¸è§é”™è¯¯

### è‡ªå®šä¹‰åŸŸåæ— æ³•è®¿é—®

**åŸå› **: Cloudflare Pages ç”Ÿäº§åˆ†æ”¯é…ç½®é”™è¯¯  
**è§£å†³**: ç¡®è®¤ Pages è®¾ç½®ä¸­ç”Ÿäº§åˆ†æ”¯ä¸º `main`ï¼Œå¹¶ä½¿ç”¨ `--branch=main` éƒ¨ç½²

### API è¯·æ±‚å¤±è´¥

**åŸå› **: [config.js](mdc:config.js) æœªæ­£ç¡®åŠ è½½æˆ– Worker API åœ°å€é”™è¯¯  
**è§£å†³**: æ£€æŸ¥ HTML æ–‡ä»¶æ˜¯å¦å¼•å…¥äº† `<script src="config.js"></script>`

### ç¼“å­˜é—®é¢˜

**åŸå› **: CDN ç¼“å­˜æœªæ›´æ–°  
**è§£å†³**: ç­‰å¾… 1-5 åˆ†é’Ÿæˆ–å¼ºåˆ¶åˆ·æ–°ï¼ˆCtrl+Shift+Rï¼‰
